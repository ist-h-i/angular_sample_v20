@if (messages && messages.length > 0) {
  <div class="space-y-4">
    @for (m of messages; track m) {
      <div class="flex items-start gap-3 message-row">
        <div class="w-full">
          <!-- Bubble container -->
          <div
            class="flex"
            [class.justify-start]="m.role !== 'user'"
            [class.justify-end]="m.role === 'user'"
          >
            <article
              [attr.aria-label]="'メッセージ: ' + m.content"
              class="message inline-block max-w-[78%] break-words p-3 rounded-[12px] shadow-sm transition-transform duration-200 ease-out transform"
              [class.bubble--user]="m.role === 'user'"
              [class.bubble--assistant]="m.role !== 'user'"
            >
              <div class="text-sm whitespace-pre-wrap">{{ m.content }}</div>
            </article>
          </div>

          <!-- Action buttons -->
          <div
            class="message-actions flex items-center gap-2 text-[11px] text-slate-500"
            [class.justify-start]="m.role !== 'user'"
            [class.justify-end]="m.role === 'user'"
          >
            <button
              type="button"
              class="action-button"
              aria-label="メッセージをコピー"
              (click)="onCopy(m)"
            >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="h-3.5 w-3.5">
                <rect x="9" y="9" width="11" height="11" rx="2" ry="2"></rect>
                <path d="M6 15H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v1"></path>
              </svg>
              <span class="tooltip" role="tooltip">コピー</span>
            </button>

            <button
              type="button"
              class="action-button"
              aria-label="このメッセージで再送信"
              (click)="onResend(m)"
            >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="h-3.5 w-3.5">
                <path d="M4 12a8 8 0 0 1 14.32-4.906M20 4v6h-6"></path>
                <path d="M20 12a8 8 0 0 1-14.32 4.906M4 20v-6h6"></path>
              </svg>
              <span class="tooltip" role="tooltip">再送信</span>
            </button>
          </div>
        </div>
      </div>
    }
  </div>
} @else {
  <div class="text-gray-500 text-sm text-center mt-5">まだメッセージがありません</div>
}
